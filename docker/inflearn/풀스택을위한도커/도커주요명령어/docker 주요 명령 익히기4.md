# docker 주요 명령 익히기4 (컨테이너를 다루는 다양한 옵션)

# 6. 실행 중인 컨테이너 종료하기

- 컨테이너 종료하기
    - 이전에 백그라운드로 실행한 myubuntu3를 중지하려면 다음 명령을 실행

```docker

docker stop myubuntu3
```

# 7. 웹서버로 docker run 옵션 테스트해보기

- 웹 서버는 크게 두 가지 프로그램이 많이 사용됨
    - apache
    - nginx(엔진엑스)
- 이 중에서 apache 웹 서버를 docker로 구동해보며, 실제 docker run 사용 예와 관련 옵션을 좀 더 이해해보기로 함

## 7.1 apache웹 서버 공식 docker 찾기

- 각 docker 마다 공식 이름이 프로그램명과 동일한 경우가 일반적이지만, apache는 httpd 이름을 사용함

```docker

docker search httpd

docker search httpd --limit=5
```

## 7.2 이미지 다운받고 바로 컨테이너로 만들어 실행시키기 (-p 옵션 이해하기)

다음과 같이 명령하면 몇 가지 문제점이 눈에 띔

```docker
docker run httpd
```

- 처음에 다음과 같이 메세지가 나오는 것은 문제가 안됨. 자신의 PC에 해당 이미지가 없다는 의미로, 바로 이후에 해당 이미지 이름을 Docker Hub에서 찾아서 다운로드함

```docker
Unable to find image 'httpd:latest' locally
```

- 커맨드 라인에 다음 명령을 할 수 없음 (해당 컨테이너가 foreground로 실행되고 있기 때문임)
    - apache 웹 서버가 실행된 상태로, 해당 프로그램 로그만 화면에 보여짐(다른 터미널로 docker ps를 명령하면, 해당 컨테이너가 실행중임은 알 수 있음)
    - Ctrl+c로 강제 중단시킨 후, 다음과 같이 명령함(관련 컨테이너는 중지 상태에 있으므로, 삭제해줘도 됨)
    - -d 옵션을 주어 background에서 해당 컨테이너를 실행하면 됨. 보통 컨테이너는 background로 실행하는 것이 일반적임

```docker
docker run -d --name apacheweb httpd
```

- 이번에는 해당 웹서에 어떻게 접속해야할지 알 수 없음
    - 포트 포워딩이 필요함
    - docker를 실행한 PC를 HOST PC(호스트 PC)라고 함
    - docker 컨테이너가 실행되면. 127.17.0.0/16(서브네잇이 255.255.0.0)인 Private IP가 할당 됨
        - /16은 16비트까지 IP 할당이 된다는 의미로, 127.17.0.0 ~ 127.17.255.255까지 동일 네트워크 상에 IP주소를 가질 수 있음을 의미함
    - 호스트 PC IP에 특정 port로 access시, 해당 port를 docker컨테이너의 특정 Private Ip의 특정 포트로 변환해줄 수 있음. 이를 NAPT(Network Address Port Traslation)기술이라고 함
    - 이를 지원해주는 옵션이 -p옵션임
        - 따라서 다음과 같이 작성하면 apache2컨테이너는 apache 웹 서버 프로그램을 실행하고, 호스트 PC에 9999포트로 접속하면, 자동으로 이를 해당 컨테이너의 80포트에 연결해주겠다는 라는 의미임

```docker
docker run -d -p 9999:80 --name apacheweb2 httpd
```

- 위와 같이 실행 후 크롬 웹브라우저 상에서 localhost:9999를 접속하면 내부 웹서버가 동작함을 확인할 수 있음

[리눅스에서 실행하는 경우]

- aws에 접속하여 [보안] → [보안 그룹] → [Edit inbound rules] → [규칙 추가] 포트범위 9999를 추가해준다.

![Untitled](docker%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%AD%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%85%E1%85%A7%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%A8%E1%84%92%E1%85%B5%E1%84%80%E1%85%B54%20(%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%83%E1%85%A1%E1%84%85%E1%85%AE%E1%84%82%E1%85%B3%E1%86%AB%20%20d73828ee5f17430f8e1f1f1e309bed21/Untitled.png)

![Untitled](docker%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%AD%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%85%E1%85%A7%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%A8%E1%84%92%E1%85%B5%E1%84%80%E1%85%B54%20(%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%83%E1%85%A1%E1%84%85%E1%85%AE%E1%84%82%E1%85%B3%E1%86%AB%20%20d73828ee5f17430f8e1f1f1e309bed21/Untitled%201.png)

![Untitled](docker%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%AD%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%85%E1%85%A7%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%A8%E1%84%92%E1%85%B5%E1%84%80%E1%85%B54%20(%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%83%E1%85%A1%E1%84%85%E1%85%AE%E1%84%82%E1%85%B3%E1%86%AB%20%20d73828ee5f17430f8e1f1f1e309bed21/Untitled%202.png)

![Untitled](docker%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%AD%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%85%E1%85%A7%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%A8%E1%84%92%E1%85%B5%E1%84%80%E1%85%B54%20(%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%83%E1%85%A1%E1%84%85%E1%85%AE%E1%84%82%E1%85%B3%E1%86%AB%20%20d73828ee5f17430f8e1f1f1e309bed21/Untitled%203.png)

### 결과

![Untitled](docker%20%E1%84%8C%E1%85%AE%E1%84%8B%E1%85%AD%20%E1%84%86%E1%85%A7%E1%86%BC%E1%84%85%E1%85%A7%E1%86%BC%20%E1%84%8B%E1%85%B5%E1%86%A8%E1%84%92%E1%85%B5%E1%84%80%E1%85%B54%20(%E1%84%8F%E1%85%A5%E1%86%AB%E1%84%90%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%82%E1%85%A5%E1%84%85%E1%85%B3%E1%86%AF%20%E1%84%83%E1%85%A1%E1%84%85%E1%85%AE%E1%84%82%E1%85%B3%E1%86%AB%20%20d73828ee5f17430f8e1f1f1e309bed21/Untitled%204.png)